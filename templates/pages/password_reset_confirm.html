{% extends 'base.html' %}
{% load static %}

{% block title %}Set New Password - PetPal{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/login.css' %}">
<style>
.error-icon {
    font-size: 4rem;
    color: #dc3545;
    margin-bottom: 1.5rem;
}
</style>
{% endblock %}

{% block content %}
<div class="login-wrapper">
  <div class="login-container">
    {% if validlink %}
      <div class="login-header">
        <i class="fas fa-key text-warning mb-3"></i>
        <h2 class="fw-bold">Set New Password</h2>
        <p class="text-muted">Please enter your new password</p>
      </div>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}

      <form class="login-form" method="post">
        {% csrf_token %}
        
        <div class="form-group mb-3">
          <label for="password1" class="form-label">New Password</label>
          <div class="input-group">
            <span class="input-icon">
              <i class="fas fa-lock"></i>
            </span>
            <input type="password" class="form-control" id="password1" name="password1" placeholder="Enter new password" required minlength="8">
            <span class="password-toggle" onclick="togglePassword('password1', 'toggleIcon1')">
              <i class="fas fa-eye" id="toggleIcon1"></i>
            </span>
          </div>
          <small class="form-text text-muted">Must be at least 8 characters</small>
        </div>

        <div class="form-group mb-3">
          <label for="password2" class="form-label">Confirm New Password</label>
          <div class="input-group">
            <span class="input-icon">
              <i class="fas fa-lock"></i>
            </span>
            <input type="password" class="form-control" id="password2" name="password2" placeholder="Confirm new password" required>
            <span class="password-toggle" onclick="togglePassword('password2', 'toggleIcon2')">
              <i class="fas fa-eye" id="toggleIcon2"></i>
            </span>
          </div>
        </div>

        <button type="submit" class="btn btn-warning w-100 login-btn">
          <i class="fas fa-check me-2"></i>Reset Password
        </button>
      </form>
    {% else %}
      <div class="text-center">
        <div class="error-icon">
          <i class="fas fa-times-circle"></i>
        </div>
        <h2 class="fw-bold">Invalid Reset Link</h2>
        <p class="text-muted mb-4">
          This password reset link is invalid or has expired. Please request a new one.
        </p>
        <a href="{% url 'password_reset_request' %}" class="btn btn-warning">
          <i class="fas fa-redo me-2"></i>Request New Reset Link
        </a>
      </div>
    {% endif %}

    <div class="login-footer">
      <p class="text-center mt-4">
        <a href="{% url 'login' %}" class="signup-link">
          <i class="fas fa-arrow-left me-1"></i>Back to Login
        </a>
      </p>
    </div>
  </div>
</div>

<script>
function togglePassword(fieldId, iconId) {
    const passwordField = document.getElementById(fieldId);
    const toggleIcon = document.getElementById(iconId);
    
    if (passwordField.type === "password") {
        passwordField.type = "text";
        toggleIcon.classList.remove("fa-eye");
        toggleIcon.classList.add("fa-eye-slash");
    } else {
        passwordField.type = "password";
        toggleIcon.classList.remove("fa-eye-slash");
        toggleIcon.classList.add("fa-eye");
    }
}
</script>
{% endblock %}
