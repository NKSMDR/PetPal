{% extends 'base.html' %}
{% load static %}

{% block title %}Map Test - PetPal{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
    #test-map {
        width: 100%;
        height: 400px;
        border: 2px solid #ccc;
        margin: 20px 0;
    }
    
    .debug-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <h1>Map Test Page</h1>
            <p>This is a simple test to check if the map loads properly.</p>
            
            <div class="debug-info" id="debug-info">
                Initializing map test...
            </div>
            
            <div id="test-map"></div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="testMap()">Test Map</button>
                <button class="btn btn-secondary" onclick="checkLeaflet()">Check Leaflet</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let testMap = null;

function updateDebugInfo(message) {
    const debugInfo = document.getElementById('debug-info');
    debugInfo.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
    console.log(message);
}

function checkLeaflet() {
    updateDebugInfo('Checking Leaflet library...');
    
    if (typeof L === 'undefined') {
        updateDebugInfo('‚ùå Leaflet library not loaded!');
        return false;
    }
    
    updateDebugInfo('‚úÖ Leaflet library loaded successfully');
    updateDebugInfo('Leaflet version: ' + L.version);
    return true;
}

function testMap() {
    updateDebugInfo('Starting map test...');
    
    if (!checkLeaflet()) {
        return;
    }
    
    const mapContainer = document.getElementById('test-map');
    updateDebugInfo('Map container found: ' + !!mapContainer);
    updateDebugInfo('Container dimensions: ' + mapContainer.offsetWidth + 'x' + mapContainer.offsetHeight);
    
    try {
        // Create map
        testMap = L.map('test-map', {
            center: [27.7172, 85.3240],
            zoom: 13
        });
        
        updateDebugInfo('‚úÖ Map created successfully');
        
        // Add tile layer
        const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        });
        
        tileLayer.on('loading', function() {
            updateDebugInfo('üîÑ Loading tiles...');
        });
        
        tileLayer.on('load', function() {
            updateDebugInfo('‚úÖ Tiles loaded successfully');
        });
        
        tileLayer.on('tileerror', function(e) {
            updateDebugInfo('‚ùå Tile error: ' + e.message);
        });
        
        tileLayer.addTo(testMap);
        updateDebugInfo('‚úÖ Tile layer added to map');
        
        // Add a marker
        const marker = L.marker([27.7172, 85.3240]).addTo(testMap);
        marker.bindPopup('Test marker - Map is working!').openPopup();
        updateDebugInfo('‚úÖ Marker added and popup opened');
        
    } catch (error) {
        updateDebugInfo('‚ùå Map creation failed: ' + error.message);
        console.error('Map error:', error);
    }
}

// Auto-test on page load
document.addEventListener('DOMContentLoaded', function() {
    updateDebugInfo('Page loaded, starting auto-test...');
    setTimeout(testMap, 1000);
});
</script>
{% endblock %} 