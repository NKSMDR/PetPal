{% extends 'base.html' %}
{% load static %}

{% block title %}PetPal - Your Dog's Best Friend{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/home.css' %}">
<style>
    html {
        scroll-behavior: smooth;
    }
    
    section {
        position: relative;
    }
    
    /* Add subtle entrance animations */
    .fade-in-section {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    
    .fade-in-section.is-visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>
{% endblock %}

{% block content %}
<!-- Hidden messages container for JavaScript to read -->
{% if messages %}
<div id="django-messages" style="display: none;">
  {% for message in messages %}
  <div data-message="{{ message|escapejs }}" data-tags="{{ message.tags|default:'info' }}"></div>
  {% endfor %}
</div>
{% endif %}

<!-- Image Carousel Section -->
<section class="home-carousel-section">
  <div id="homeCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
      <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="0" class="active"></button>
      <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="1"></button>
      <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="2"></button>
    </div>
    
    <div class="carousel-inner">
      <!-- Slide 1 -->
      <div class="carousel-item active">
        <img src="{% static 'img/hero-bg.jpg' %}" class="d-block w-100" alt="Find Your Perfect Dog">
        <div class="carousel-caption">
          <div class="carousel-content">
            <h2 class="display-4 fw-bold mb-3">Find Your Perfect Companion</h2>
            <p class="lead mb-4">Browse hundreds of healthy, happy dogs waiting for their forever home</p>
            <a href="{% url 'browse_pets' %}" class="btn btn-warning btn-lg me-3">
              <i class="fas fa-search me-2"></i>Browse Dogs
            </a>
            <a href="{% url 'marketplace' %}" class="btn btn-outline-light btn-lg">
              <i class="fas fa-store me-2"></i>Marketplace
            </a>
          </div>
        </div>
      </div>
      
      <!-- Slide 2 -->
      <div class="carousel-item">
        <img src="{% static 'img/golden.jpg' %}" class="d-block w-100" alt="Quality Accessories">
        <div class="carousel-caption">
          <div class="carousel-content">
            <h2 class="display-4 fw-bold mb-3">Everything Your Dog Needs</h2>
            <p class="lead mb-4">Premium food, toys, and accessories for your furry friend</p>
            <a href="{% url 'accessories' %}" class="btn btn-warning btn-lg me-3">
              <i class="fas fa-shopping-bag me-2"></i>Shop Accessories
            </a>
            <a href="{% url 'browse_pets' %}" class="btn btn-outline-light btn-lg">
              <i class="fas fa-dog me-2"></i>View Breeds
            </a>
          </div>
        </div>
      </div>
      
      <!-- Slide 3 -->
      <div class="carousel-item">
        <img src="{% static 'img/labrador.jpg' %}" class="d-block w-100" alt="Join Community">
        <div class="carousel-caption">
          <div class="carousel-content">
            <h2 class="display-4 fw-bold mb-3">Join Our Community</h2>
            <p class="lead mb-4">Connect with fellow dog lovers and trusted sellers nationwide</p>
            {% if user.is_authenticated %}
              <a href="{% url 'sell_pet' %}" class="btn btn-warning btn-lg me-3">
                <i class="fas fa-plus-circle me-2"></i>Sell Your Dog
              </a>
              <a href="{% url 'my_pets' %}" class="btn btn-outline-light btn-lg">
                <i class="fas fa-list me-2"></i>My Listings
              </a>
            {% else %}
              <a href="{% url 'register' %}" class="btn btn-warning btn-lg me-3">
                <i class="fas fa-user-plus me-2"></i>Sign Up Now
              </a>
              <a href="{% url 'login' %}" class="btn btn-outline-light btn-lg">
                <i class="fas fa-sign-in-alt me-2"></i>Login
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    
    <button class="carousel-control-prev" type="button" data-bs-target="#homeCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#homeCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</section>

<!-- üåÑ Parallax Section -->
<section class="parallax-section text-white d-flex align-items-center justify-content-center">
  <div class="text-center">
    <h2 class="display-5 fw-bold">Adopt. Love. Repeat. üêæ</h2>
    <p class="lead">Every dog deserves a family. Yours might be just a scroll away.</p>
    <a href="{% url 'marketplace' %}" class="btn btn-warning rounded-pill px-4 py-2 mt-3">Explore Community Marketplace</a>
  </div>
</section>

<!-- Category Cards -->
<section class="py-5 bg-light text-center">
  <div class="container">
    <h2 class="mb-4 fw-bold">What We Offer</h2>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card h-100">
          <img src="{% static 'img/dog.jpg' %}" class="card-img-top" alt="Professional Dogs">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Professional Dogs</h5>
            <p class="card-text flex-grow-1">Find healthy, well-bred dogs from trusted breeders and pet stores.</p>
            <a href="{% url 'browse_pets' %}" class="btn btn-outline-primary rounded-pill mt-auto">Browse Dogs</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100">
          {% comment %} <img src="{% static 'img/marketplace.jpg' %}" class="card-img-top" alt="Community Marketplace"> {% endcomment %}
          <img src="{% static 'img/golden.jpg' %}" class="card-img-top" alt="Community Marketplace">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Community Marketplace</h5>
            <p class="card-text flex-grow-1">Buy and sell dogs directly with other dog lovers in your community.</p>
            <a href="{% url 'marketplace' %}" class="btn btn-outline-success rounded-pill mt-auto">Visit Marketplace</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100">
          <img src="{% static 'img/accessories.jpg' %}" class="card-img-top" alt="Dog Accessories">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Dog Accessories</h5>
            <p class="card-text flex-grow-1">All dog essentials ‚Äì food, toys, grooming supplies and more.</p>
            <a href="{% url 'accessories' %}" class="btn btn-outline-primary rounded-pill mt-auto">Shop Now</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Quick Actions Section -->
<section class="py-5">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-6 mb-4">
        <div class="quick-action-card p-4 bg-primary text-white rounded">
          <h4 class="fw-bold mb-3">üè™ Looking for a Dog?</h4>
          <p class="mb-3">Browse our professional listings or check out community marketplace</p>
          <div class="d-flex gap-2 justify-content-center">
            <a href="{% url 'browse_pets' %}" class="btn btn-light">Professional Dogs</a>
            <a href="{% url 'marketplace' %}" class="btn btn-outline-light">Marketplace</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="quick-action-card p-4 bg-success text-white rounded">
          <h4 class="fw-bold mb-3">üí∞ Want to Sell Your Dog?</h4>
          <p class="mb-3">List your dog on our community marketplace and find loving homes</p>
          <div class="d-flex gap-2 justify-content-center">
            {% if user.is_authenticated %}
              <a href="{% url 'sell_pet' %}" class="btn btn-light">Sell Your Dog</a>
              <a href="{% url 'my_pets' %}" class="btn btn-outline-light">My Listings</a>
            {% else %}
              <a href="{% url 'login' %}" class="btn btn-light">Login to Sell</a>
              <a href="{% url 'register' %}" class="btn btn-outline-light">Sign Up</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Testimonials - Dynamic from Admin -->
{% if settings.show_testimonials and testimonials %}
<section class="py-5 text-center bg-light">
  <div class="container">
    <h2 class="mb-4 fw-bold">Our Happy Customers</h2>
    <div class="row g-4">
      {% for testimonial in testimonials %}
      <div class="col-md-4">
        <div class="testimonial-card p-4 bg-white rounded shadow-sm">
          {% if testimonial.customer_image %}
          <img src="{{ testimonial.customer_image.url }}" alt="{{ testimonial.customer_name }}" 
               class="rounded-circle mb-3" style="width: 80px; height: 80px; object-fit: cover;">
          {% endif %}
          <div class="mb-2">
            {% for i in "12345"|slice:":"|make_list %}
              {% if forloop.counter <= testimonial.rating %}
                <i class="fas fa-star text-warning"></i>
              {% else %}
                <i class="far fa-star text-warning"></i>
              {% endif %}
            {% endfor %}
          </div>
          <p>"{{ testimonial.testimonial_text }}"</p>
          <h6 class="mt-3">‚Äì {{ testimonial.customer_name }}</h6>
          {% if testimonial.location %}
          <small class="text-muted">{{ testimonial.location }}</small>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<!-- Featured Pets - Dynamic from Admin -->
{% if settings.show_featured_pets and featured_pets %}
<section class="py-5 bg-white">
  <div class="container">
    <h2 class="fw-bold mb-4 text-center">Featured Pets</h2>
    <div class="row g-4">
      {% for pet in featured_pets %}
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 shadow-sm">
          {% if pet.image %}
          <img src="{{ pet.image.url }}" class="card-img-top" alt="{{ pet.breed.name }}" style="height: 250px; object-fit: cover;">
          {% else %}
          <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 250px;">
            <i class="fas fa-paw fa-3x text-muted"></i>
          </div>
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ pet.breed.name }}</h5>
            <p class="text-muted mb-2">
              <i class="fas fa-venus-mars"></i> {{ pet.get_gender_display }} | 
              <i class="fas fa-birthday-cake"></i> {{ pet.age }}
            </p>
            <p class="card-text text-truncate">{{ pet.description|default:"Lovely pet looking for a home" }}</p>
            <div class="d-flex justify-content-between align-items-center">
              <span class="h5 mb-0 text-primary">NRS {{ pet.price }}</span>
              <a href="{% url 'pet_detail' pet.id %}" class="btn btn-sm btn-outline-primary">View Details</a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-4">
      <a href="{% url 'browse_pets' %}" class="btn btn-primary">View All Pets</a>
    </div>
  </div>
</section>
{% endif %}

<!-- Popular Dog Breeds -->
<section class="py-5">
  <div class="container text-center">
    <h2 class="fw-bold mb-4">Popular Dog Breeds</h2>
    <div class="row">
      <div class="col-md-3 col-6 mb-4">
        <div class="breed-card">
          <img src="{% static 'img/labrador.jpg' %}" alt="Labrador" class="img-fluid rounded-circle mb-2" style="height: 120px; width: 120px; object-fit: cover;">
          <h6>Labrador Retriever</h6>
          <small class="text-muted">Friendly & Active</small>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-4">
        <div class="breed-card">
          <img src="{% static 'img/golden.jpg' %}" alt="Golden Retriever" class="img-fluid rounded-circle mb-2" style="height: 120px; width: 120px; object-fit: cover;">
          <h6>Golden Retriever</h6>
          <small class="text-muted">Gentle & Smart</small>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-4">
        <div class="breed-card">
          <img src="{% static 'img/german.jpeg' %}" alt="German Shepherd" class="img-fluid rounded-circle mb-2" style="height: 120px; width: 120px; object-fit: cover;">
          <h6>German Shepherd</h6>
          <small class="text-muted">Loyal & Brave</small>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-4">
        <div class="breed-card">
          <img src="{% static 'img/husky.jpg' %}" alt="Siberian Husky" class="img-fluid rounded-circle mb-2" style="height: 120px; width: 120px; object-fit: cover;">
          <h6>Siberian Husky</h6>
          <small class="text-muted">Energetic & Outgoing</small>
        </div>
      </div>
    </div>
    <div class="mt-4">
      <a href="{% url 'breed_list' %}" class="btn btn-outline-primary rounded-pill">View All Breeds</a>
    </div>
  </div>
</section>

<!-- How It Works -->
<section class="bg-light py-5 text-center">
  <div class="container">
    <h2 class="fw-bold mb-4">How PetPal Works</h2>
    <div class="row align-items-center">
      <div class="col-md-4">
        <div class="p-3">
          <div class="step-icon mb-3">
            <span class="display-5 text-warning">üîç</span>
          </div>
          <h5 class="fw-bold mt-3">Browse or Post</h5>
          <p>Search professional listings or post your dog on our marketplace!</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-3">
          <div class="step-icon mb-3">
            <span class="display-5 text-warning">üí¨</span>
          </div>
          <h5 class="fw-bold mt-3">Connect</h5>
          <p>Contact sellers directly and ask questions about the dogs.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-3">
          <div class="step-icon mb-3">
            <span class="display-5 text-warning">üè†</span>
          </div>
          <h5 class="fw-bold mt-3">Take Home</h5>
          <p>Complete the adoption and welcome your new furry family member!</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Newsletter -->
<section class="cta text-white text-center py-5">
  <div class="container">
    <h3>Subscribe For Dog Care Tips & Special Offers</h3>
    <p class="mb-4">Get the latest updates on dog care, training tips, and exclusive deals!</p>
    <form class="row justify-content-center mt-4">
      <div class="col-md-4">
        <input type="email" class="form-control rounded-pill p-3" placeholder="Enter your email">
      </div>
      <div class="col-auto">
        <button class="btn btn-warning rounded-pill px-4 py-3 fw-bold">Subscribe</button>
      </div>
    </form>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Convert ALL Django messages to toast notifications
document.addEventListener('DOMContentLoaded', function() {
  const djangoMessages = [];
  const messageContainer = document.getElementById('django-messages');
  
  if (messageContainer) {
    const messageDivs = messageContainer.querySelectorAll('[data-message]');
    messageDivs.forEach(div => {
      djangoMessages.push({
        text: div.getAttribute('data-message'),
        type: div.getAttribute('data-tags') || 'info'
      });
    });
  }
  
  // Fallback: Also collect from template if hidden div is empty
  {% if messages %}
    {% for message in messages %}
    if (!djangoMessages.find(m => m.text === "{{ message|escapejs }}")) {
      djangoMessages.push({
        text: "{{ message|escapejs }}",
        type: "{{ message.tags|default:'info' }}",
      });
    }
    {% endfor %}
  {% endif %}
  
  // Show toast for ALL messages
  if (djangoMessages.length > 0) {
    console.log('Found', djangoMessages.length, 'message(s):', djangoMessages);
    djangoMessages.forEach((msg, index) => {
      setTimeout(() => {
        showToastNotification(msg.text, msg.type, index);
      }, 500 + (index * 300));
    });
  }
  
  function showToastNotification(message, type = 'info', index = 0) {
    const toast = document.createElement('div');
    
    // Map Django message tags to Bootstrap alert types
    let alertType = type;
    if (type === 'error') alertType = 'danger';
    if (!['success', 'danger', 'warning', 'info'].includes(alertType)) {
      alertType = 'info';
    }
    
    // Choose appropriate icon based on type
    let icon = 'fa-info-circle';
    if (alertType === 'success') icon = 'fa-check-circle';
    else if (alertType === 'danger') icon = 'fa-exclamation-circle';
    else if (alertType === 'warning') icon = 'fa-exclamation-triangle';
    
    toast.className = `alert alert-${alertType} position-fixed end-0 m-3 shadow toast-notification`;
    toast.style.minWidth = '300px';
    toast.style.maxWidth = '400px';
    toast.style.top = `${80 + (index * 80)}px`;
    toast.style.zIndex = '9999';
    toast.style.opacity = '0';
    toast.style.transform = 'translateX(100%)';
    toast.style.transition = 'all 0.3s ease';
    toast.innerHTML = `
      <div class="d-flex align-items-center">
        <i class="fas ${icon} me-2"></i>
        <span>${message}</span>
        <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
      </div>
    `;
    
    document.body.appendChild(toast);
    
    // Animate in
    setTimeout(() => {
      toast.style.opacity = '1';
      toast.style.transform = 'translateX(0)';
    }, 10);
    
    // Auto-dismiss after 5 seconds
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 300);
    }, 5000);
  }
});
</script>
{% endblock %}