{% extends 'base.html' %}
{% load static %}

{% block title %}About Us - PetPal{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/about_us.css' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section py-5 bg-gradient-primary text-white">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h1 class="display-4 fw-bold mb-3">About PetPal</h1>
        <p class="lead mb-4">Learn more about our mission, values, and the team behind PetPal. Discover how we're making pet adoption and sales safer, more transparent, and more joyful for everyone.</p>
      </div>
      <div class="col-lg-4 text-center">
        <img src="{% static 'img/puppy.jpeg' %}" alt="About PetPal" class="img-fluid rounded-circle mb-2" style="max-height: 300px;">
      </div>
    </div>
  </div>
</section>

<!-- About Us Content -->
<section class="py-5">
  <div class="container">
    <!-- About Us Section -->
    <div class="row align-items-center mb-5">
      <div class="col-lg-6">
        <div class="about-us-content">
          <h2 class="fw-bold mb-4 text-primary">Our Story</h2>
          <p class="lead mb-4">
            We're passionate about connecting loving families with their perfect furry companions. 
            Since our founding, PetPal has been dedicated to making pet adoption and sales safe, 
            transparent, and joyful for everyone involved.
          </p>
          <div class="row mb-4">
            <div class="col-6">
              <div class="stat-card text-center p-3">
                <h3 class="text-warning fw-bold mb-1">500+</h3>
                <p class="mb-0 small">Happy Families</p>
              </div>
            </div>
            <div class="col-6">
              <div class="stat-card text-center p-3">
                <h3 class="text-warning fw-bold mb-1">1000+</h3>
                <p class="mb-0 small">Pets Rehomed</p>
              </div>
            </div>
          </div>
          <p class="mb-4">
            Our mission is to ensure every pet finds a loving home while providing a platform 
            that's both professional for breeders and accessible for families. We believe in 
            transparency, care, and the special bond between humans and their pets.
          </p>
          <div class="d-flex gap-3 flex-wrap">
            <div class="feature-point">
              <i class="fas fa-shield-alt text-success me-2"></i>
              <span>Verified Listings</span>
            </div>
            <div class="feature-point">
              <i class="fas fa-heart text-danger me-2"></i>
              <span>Pet Health Guaranteed</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="about-image-container w-75">
          <img src="{% static 'img/happyfamily.jpeg' %}" alt="Happy pets and families" class="img-fluid rounded-3 shadow">
        </div>
      </div>
    </div>

    <!-- Mission & Values -->
    <div class="row mb-5">
      <div class="col-md-4">
        <div class="value-card text-center p-4">
          <div class="value-icon mb-3">
            <i class="fas fa-paw fa-3x text-primary"></i>
          </div>
          <h4 class="fw-bold mb-3">Pet Welfare First</h4>
          <p>Every decision we make prioritizes the health, safety, and happiness of the pets on our platform.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="value-card text-center p-4">
          <div class="value-icon mb-3">
            <i class="fas fa-users fa-3x text-success"></i>
          </div>
          <h4 class="fw-bold mb-3">Community Trust</h4>
          <p>We build lasting relationships based on transparency, honesty, and mutual respect between all parties.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="value-card text-center p-4">
          <div class="value-icon mb-3">
            <i class="fas fa-star fa-3x text-warning"></i>
          </div>
          <h4 class="fw-bold mb-3">Excellence</h4>
          <p>We continuously improve our platform to provide the best possible experience for pets and their families.</p>
        </div>
      </div>
    </div>

    <!-- Store Location Section -->
    <div class="store-location-section">
      <div class="text-center mb-4">
        <h2 class="fw-bold mb-3">Visit Our Store</h2>
        <p class="lead">Come meet our team and see our facilities in person!</p>
      </div>
      
      <div class="row align-items-center">
        <div class="col-lg-6">
          <div class="store-info-card p-4">
            <h4 class="fw-bold mb-3 text-primary">
              <i class="fas fa-store me-2"></i>PetPal Store
            </h4>
            <div class="store-details">
              <div class="detail-item mb-3">
                <i class="fas fa-map-marker-alt text-warning me-3"></i>
                <div>
                  <strong>Address:</strong><br>
                  Kathmandu, Nepal<br>
                  (Lat: 27.7044, Lng: 85.3075)
                </div>
              </div>
              <div class="detail-item mb-3">
                <i class="fas fa-clock text-warning me-3"></i>
                <div>
                  <strong>Opening Hours:</strong><br>
                  Mon - Fri: 9:00 AM - 7:00 PM<br>
                  Sat - Sun: 10:00 AM - 6:00 PM
                </div>
              </div>
              <div class="detail-item mb-3">
                <i class="fas fa-phone text-warning me-3"></i>
                <div>
                  <strong>Contact:</strong><br>
                  +977-1-4444444<br>
                  info@petpal.com
                </div>
              </div>
            </div>
            <button class="btn btn-warning btn-lg mt-3 w-100" onclick="openFullMap()">
              <i class="fas fa-map me-2"></i>View Full Map & Get Directions
            </button>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="map-container" onclick="openFullMap()">
            <div id="preview-map" class="preview-map"></div>
            <div class="map-overlay">
              <div class="map-overlay-content">
                <i class="fas fa-expand-arrows-alt fa-2x mb-2"></i>
                <p class="mb-0">Tap to enlarge map</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Full Screen Map Modal -->
<div class="modal fade" id="mapModal" tabindex="-1" aria-labelledby="mapModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="mapModalLabel">
          <i class="fas fa-map-marker-alt me-2"></i>PetPal Store Location
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <div id="full-map" style="height: 100vh; width: 100%;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>

<script>
let previewMap, fullMap;
let storeLatLng = [27.7044, 85.3075];
let userLatLng = null;
let userMarker = null;
let toStoreRouteControl = null;
let searchRouteControl = null;
let destinationLatLng = null;

// Initialize preview map
function initPreviewMap() {
  previewMap = L.map('preview-map', {
    zoomControl: false,
    dragging: false,
    touchZoom: false,
    doubleClickZoom: false,
    scrollWheelZoom: false,
    boxZoom: false,
    keyboard: false
  }).setView(storeLatLng, 14);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(previewMap);

  const storeIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
    iconSize: [30, 40],
    iconAnchor: [15, 40],
    popupAnchor: [0, -40]
  });

  L.marker(storeLatLng, { icon: storeIcon })
    .addTo(previewMap)
    .bindPopup("<b>PetPal Store</b><br>Visit us!");
}

// Initialize full map
function initFullMap() {
  if (fullMap) {
    fullMap.remove();
  }

  fullMap = L.map('full-map').setView(storeLatLng, 14);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(fullMap);

  const storeIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
    iconSize: [30, 40],
    iconAnchor: [15, 40],
    popupAnchor: [0, -40]
  });

  const storeMarker = L.marker(storeLatLng, { icon: storeIcon })
    .addTo(fullMap)
    .bindPopup("<b>PetPal Store</b><br>Visit us!")
    .openPopup();

  // Add geocoder search
  const geocoder = L.Control.geocoder({
    defaultMarkGeocode: false
  })
  .on('markgeocode', function(e) {
    destinationLatLng = e.geocode.center;

    if (searchRouteControl) fullMap.removeControl(searchRouteControl);

    if (userLatLng) {
      searchRouteControl = L.Routing.control({
        waypoints: [L.latLng(userLatLng), destinationLatLng],
        lineOptions: {
          styles: [{ color: 'blue', weight: 4 }]
        },
        routeWhileDragging: false,
        draggableWaypoints: false,
        addWaypoints: false
      }).addTo(fullMap);
    }

    fullMap.setView(destinationLatLng, 15);
  })
  .addTo(fullMap);

  // Track user location
  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(
      position => {
        userLatLng = [position.coords.latitude, position.coords.longitude];

        if (userMarker) {
          userMarker.setLatLng(userLatLng);
        } else {
          userMarker = L.marker(userLatLng).addTo(fullMap).bindPopup("You are here");
        }

        // Draw route from user to store
        if (toStoreRouteControl) {
          fullMap.removeControl(toStoreRouteControl);
        }

        toStoreRouteControl = L.Routing.control({
          waypoints: [L.latLng(userLatLng), L.latLng(storeLatLng)],
          routeWhileDragging: false,
          draggableWaypoints: false,
          addWaypoints: false,
          lineOptions: {
            styles: [{ color: 'red', weight: 4 }]
          },
          createMarker: () => null
        }).addTo(fullMap);
      },
      error => {
        console.error("Geolocation error:", error);
      },
      {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 10000
      }
    );
  }
}

// Open full map modal
function openFullMap() {
  const mapModal = new bootstrap.Modal(document.getElementById('mapModal'));
  mapModal.show();
  
  // Initialize full map after modal is shown
  setTimeout(() => {
    initFullMap();
  }, 300);
}

// Initialize preview map when page loads
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(() => {
    initPreviewMap();
  }, 500);
});
</script>
{% endblock %}
